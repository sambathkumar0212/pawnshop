{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Create{% endif %} Loan Scheme{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">{% if form.instance.pk %}Edit{% else %}Create{% endif %} Loan Scheme</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'scheme_list' %}">Loan Schemes</a></li>
        <li class="breadcrumb-item active">{% if form.instance.pk %}Edit {{ form.instance.name }}{% else %}Create New Scheme{% endif %}</li>
    </ol>
    
    <div class="row">
        <div class="col-lg-10 col-xl-8">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-{% if form.instance.pk %}edit{% else %}plus{% endif %} me-1"></i>
                    {% if form.instance.pk %}Edit Scheme Details{% else %}Enter Scheme Details{% endif %}
                </div>
                <div class="card-body">
                    <form method="post" id="schemeForm">
                        {% csrf_token %}
                        
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Basic Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                {{ form.name|as_crispy_field }}
                                            </div>
                                            <div class="col-md-6">
                                                {{ form.code|as_crispy_field }}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                {{ form.scheme_type|as_crispy_field }}
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-check form-switch mt-4">
                                                    {{ form.is_active }}
                                                    <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                                        Is Active
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12">
                                                {{ form.description|as_crispy_field }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Financial Parameters</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                {{ form.interest_rate|as_crispy_field }}
                                            </div>
                                            <div class="col-md-6">
                                                {{ form.processing_fee_percentage|as_crispy_field }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Duration Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                {{ form.duration_days|as_crispy_field }}
                                            </div>
                                            <div class="col-md-4">
                                                {{ form.no_interest_period_days|as_crispy_field }}
                                            </div>
                                            <div class="col-md-4">
                                                {{ form.minimum_period_days|as_crispy_field }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> {% if form.instance.pk %}Update{% else %}Create{% endif %} Scheme
                            </button>
                            <a href="{% if form.instance.pk %}{% url 'scheme_detail' form.instance.pk %}{% else %}{% url 'scheme_list' %}{% endif %}" class="btn btn-secondary ms-2">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Sidebar with Help -->
        <div class="col-lg-2 col-xl-4">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-info-circle me-1"></i>
                    Help
                </div>
                <div class="card-body">
                    <h5>Scheme Configuration Tips</h5>
                    <hr>
                    <ul class="small">
                        <li><strong>Interest Rate:</strong> Annual rate as a percentage (e.g., 12.00 for 12%)</li>
                        <li><strong>Duration:</strong> Standard loan period in days (e.g., 90 for 3 months)</li>
                        <li><strong>No Interest Period:</strong> Days at the beginning of loan when no interest is charged if repaid within this period (0 if not applicable)</li>
                        <li><strong>Minimum Period:</strong> Minimum days before a loan can be repaid (0 for no minimum)</li>
                        <li><strong>Processing Fee:</strong> Percentage of loan amount charged as processing fee</li>
                    </ul>
                    
                    <h5 class="mt-4">Scheme Type Examples</h5>
                    <hr>
                    <div class="small">
                        <p><strong>Standard Scheme:</strong> 12% interest, 90-day term, 90-day minimum period</p>
                        <p><strong>Flexible Scheme:</strong> 24% interest, 30-day term, 0-day minimum period, 23-day no interest period</p>
                        <p><strong>Premium Scheme:</strong> 36% interest, 180-day term, 30-day minimum period, 30-day no interest period</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const schemeTypeSelect = document.getElementById('id_scheme_type');
        const interestRateInput = document.getElementById('id_interest_rate');
        const durationInput = document.getElementById('id_duration_days');
        const noInterestPeriodInput = document.getElementById('id_no_interest_period_days');
        const minimumPeriodInput = document.getElementById('id_minimum_period_days');
        
        // Set suggested values based on scheme type selection
        schemeTypeSelect.addEventListener('change', function() {
            const schemeType = this.value;
            
            switch(schemeType) {
                case 'standard':
                    interestRateInput.value = '12.00';
                    durationInput.value = '90';
                    noInterestPeriodInput.value = '0';
                    minimumPeriodInput.value = '90';
                    break;
                case 'flexible':
                    interestRateInput.value = '24.00';
                    durationInput.value = '30';
                    noInterestPeriodInput.value = '23';
                    minimumPeriodInput.value = '0';
                    break;
                case 'premium':
                    interestRateInput.value = '36.00';
                    durationInput.value = '180';
                    noInterestPeriodInput.value = '30';
                    minimumPeriodInput.value = '30';
                    break;
                default:
                    // Do not change values for custom scheme
                    break;
            }
        });
    });
</script>
{% endblock %}